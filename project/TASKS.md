- [x] Add an AWS terraform configuration for the api. Absolutely everything required, so it can be deployed to a fresh blank AWS account. Do not deploy it; only create the configuration in a `terraform/` folder. You can initialize the terraform configuration and run `terraform plan` but do not apply.
    - [x] us-east-2c
    - [x] Terraform S3 backend, bucket name "threadloaf-terraform-prod".
    - [x] VPC
    - [x] Parameter Store parameter for the .env file (secret). I will set the real value manually in AWS Management Console.
    - [x] Parameter Store parameter for the URL from which to download the API release .zip (generated by our api.yml GitHub Actions workflow; not secret). I will set the real value manually in AWS Management Console.
    - [x] IAM instance role. AmazonSSMManagedInstanceCore policy to allow Session Manager connection. Custom policy to allow read-only access to the Parameter Store parameters.
    - [x] Security group. expose HTTP and HTTPS ports. Do not expose SSH since we use Session Manager for side channel access to the terminal.
    - [x] Elastic IP address
    - [x] EC2 instance, t4g.micro, Ubuntu Arm64. Tag Name="api.threadloaf.com"
    - [x] Use cloud-init user data to install node.js, download and extract the API release zip, write the .env file, set up a systemd service, and start the service. Our zip contains the node_modules and is ready to run.
- [x] Instead of downloading the release from a URL, let's download it from a private s3 bucket called "threadloaf-files-prod".
    - [x] Create that bucket in the terraform config.
    - [x] In Parameter Store change release_url to release_path, storing the path inside that bucket.
    - [x] Give the instance profile permission to GetObject from that bucket so it can download the file in its cloud init
    - [x] In cloud init, install AWSCLI and use it to download the release zip, then the rest of cloud init is the same as before.
        ```
        curl "https://awscli.amazonaws.com/awscli-exe-linux-aarch64.zip" -o "awscliv2.zip"
        unzip awscliv2.zip  
        sudo ./aws/install
        rm awscliv2.zip
        ```
- [x] Update terraform to add monitoring.
    - [x] In cloud init, install CloudWatch Agent from https://amazoncloudwatch-agent.s3.amazonaws.com/ubuntu/arm64/latest/amazon-cloudwatch-agent.deb (ARM64) and configure it
    - [x] Two metrics: memory used %, disk space used %
    - [x] One dimension: the instance ID. There's only one volume so we don't need a dimension for that.
    - [x] Alarm when either of the two metrics surpasses 90%. Alarm will send an email to `threadloaf@threadloaf.com`. Missing data = breach.
- [x] You are using Ubuntu 22.04, change it to 24.04. Ensure the cloud-init script still works on 24.
- [x] Add an IAM user that I can use for read/write access to threadloaf-terraform-prod and threadloaf-files-prod buckets, for terraform apply and uploading the release zip files.
- [x] Create an EFS filesystem for storing the Let's Encrypt certs dir. The cheapest EFS filesystem possible since it will hold less than 1MB of nearly static data.
    - [x] Give the instance profile permission to access the filesystem, if needed
    - [x] Update the EC2 instance terraform to mount the EFS filesystem
    - [x] Update env.example to include the correct mount path for EFS for LETS_ENCRYPT_CERTS_DIR
- [x] The CloudWatch Agent configuration in user-data.sh is wrong.
    - [x] The mem_used_percent metric is appearing with a host dimension, with a name like "ip-10-0-1-200". We want "instance id" as the sole dimension.
    - [x] The disk_used_percent metric is appearing with device, fstype, host, and path dimensions. We want "instance id" and "path" as the two dimensions.
    - [x] Update the CloudWatch alarms accordingly; they are pointing at nonexistent metrics right now.
